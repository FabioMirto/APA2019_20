#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

#define NOME_FILE1 "sequenze.txt"
#define NOME_FILE2 "testo.txt"
#define CHAR 5
#define MAX 20
#define RIGA 200
#define PAR 25

typedef struct {
    char sequenza[CHAR+1];
} dat;

typedef struct {
    char parola[PAR+1];
}test ;



int main() {
    int i, j, k, l, num = 0, countTot = 0, countPunct = 0, countWords = 0, len = 0, lun = 0, lung = 0;
    char riga[RIGA+1];
    char *ch;
    test testo[RIGA];
    dat dati[MAX];
    FILE *fp1, *fp2;
    fp1 = fopen(NOME_FILE1, "r");
    fp2 = fopen(NOME_FILE2, "r");

    if(fp1 == NULL || fp2 == NULL){
        printf("ERRORE NELL'APERTURA DEL FILE");
        EXIT_FAILURE;
    }

    fscanf(fp1, "%d", &num);

    for (i = 0; i < num; i++) {
        fscanf(fp1, "%s", dati[i].sequenza);
        lung = strlen(dati[i].sequenza);
        for (int l = 0; l < lung; l++) {
            dati[i].sequenza[l] = toupper(dati[i].sequenza[l]);
        }
        printf("%s\n", dati[i].sequenza);
    }

    while(fgets(riga, RIGA+1, fp2) != NULL) {
        len = strlen(riga);
        for (i = 0; i < len - 1; i++) {
            if (isalnum(riga[i]) != 0 && ispunct(riga[i+1]) != 0 && isalnum(riga[i+2]) != 0) {
                countWords++;
                countTot++;
            } if (isalnum(riga[i]) != 0 && isspace(riga[i+1]) != 0) {
                countTot++;
                countWords++;
            } if (isalnum(riga[i]) != 0 && ispunct(riga[i+1]) != 0 && isspace(riga[i+2]) != 0) {
                countWords++;
                countTot++;
            }
        }
        printf("%d\n", countWords);
        countWords = 0;
    }
    fclose(fp2);
    fp2 = fopen(NOME_FILE2, "r");
     i=0;
    while(fscanf(fp2, "%s", testo[i].parola) != EOF){
        i++;
    }
    l = 0;
    lung = 0;
    for (i = 0; i < countTot; i++) {
        lung = strlen(testo[i].parola);
        for (int l = 0; l < lung; l++) {
            testo[i].parola[l] = toupper(testo[i].parola[l]);
        }
        printf("%s\n", testo[i].parola);
    }

    for (l = 0; l < num; l++) {
       for (j = 0; j < i; j++) {
          // lun = strlen(dati[l].sequenza);
           ch = strstr(testo[j].parola, dati[l].sequenza);
               if(ch != 0){
                   printf("la sequenza %s e' contenuta in %s (in posizione %d)\n", dati[l].sequenza, testo[j].parola, j+1);
               }
           }
        }
    return 0;
}
